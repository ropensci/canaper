<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run a randomization analysis for one or more biodiversity metrics — cpr_rand_test • canaper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Run a randomization analysis for one or more biodiversity metrics — cpr_rand_test" />
<meta property="og:description" content="The observed value of the biodiversity metric(s) will be calculated for the
input community data, then compared against a set of random communities.
Various statistics are calculated from the comparison (see Value below)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">canaper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/canape.html">CANAPE example</a>
    </li>
    <li>
      <a href="../articles/how-many-rand.html">How many randomizations?</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel computing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/joelnitta/canaper/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run a randomization analysis for one or more biodiversity metrics</h1>
    <small class="dont-index">Source: <a href='https://github.com/joelnitta/canaper/blob/master/R/cpr_rand_test.R'><code>R/cpr_rand_test.R</code></a></small>
    <div class="hidden name"><code>cpr_rand_test.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The observed value of the biodiversity metric(s) will be calculated for the
input community data, then compared against a set of random communities.
Various statistics are calculated from the comparison (see <strong>Value</strong> below).</p>
    </div>

    <pre class="usage"><span class='fu'>cpr_rand_test</span><span class='op'>(</span>
  <span class='va'>comm</span>,
  <span class='va'>phy</span>,
  <span class='va'>null_model</span>,
  n_reps <span class='op'>=</span> <span class='fl'>100</span>,
  n_iterations <span class='op'>=</span> <span class='fl'>10000</span>,
  thin <span class='op'>=</span> <span class='fl'>1</span>,
  metrics <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"pd"</span>, <span class='st'>"rpd"</span>, <span class='st'>"pe"</span>, <span class='st'>"rpe"</span><span class='op'>)</span>,
  site_col <span class='op'>=</span> <span class='st'>"site"</span>,
  tbl_out <span class='op'>=</span> <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/is_tibble.html'>is_tibble</a></span><span class='op'>(</span><span class='va'>comm</span><span class='op'>)</span>,
  quiet <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>comm</th>
      <td><p>Dataframe, tibble, or matrix; input community data with
sites (communities) as rows and species as columns. Either presence-absence
data (values only 0s or 1s) or abundance data (values &gt;= 0) accepted, but
calculations do not use abundance-weighting, so results from abundance data
will be the same as if converted to presence-absence before analysis.</p></td>
    </tr>
    <tr>
      <th>phy</th>
      <td><p>List of class <code>phylo</code>; input phylogeny.</p></td>
    </tr>
    <tr>
      <th>null_model</th>
      <td><p>Character vector of length 1 or object of class <code>commsim</code>;
either the name of the model to use for generating random communities (null
model), or a custom null model. For full list of available predefined null
models, see the help file of <code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::commsim()</a></code>, or run
<code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::make.commsim()</a></code>. An object of class <code>commsim</code> can be generated with
<code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::commsim()</a></code> (see <strong>Examples</strong> in <code><a href='cpr_rand_comm.html'>cpr_rand_comm</a>()</code>).</p></td>
    </tr>
    <tr>
      <th>n_reps</th>
      <td><p>Numeric vector of length 1; number of random communities to
replicate.</p></td>
    </tr>
    <tr>
      <th>n_iterations</th>
      <td><p>Numeric vector of length 1; number of iterations to use
for sequential null models; ignored for non-sequential models.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>Numeric vector of length 1; thinning parameter used by some
null models in <code>vegan</code> (e.g., <code>quasiswap</code>); ignored for other models.</p></td>
    </tr>
    <tr>
      <th>metrics</th>
      <td><p>Character vector; names of biodiversity metrics to calculate.
May include one or more of: <code>pd</code>, <code>rpd</code>, <code>pe</code>, <code>rpe</code> (case-sensitive).</p></td>
    </tr>
    <tr>
      <th>site_col</th>
      <td><p>Character vector of length 1; name of column in <code>comm</code> that
contains the site names; only used if <code>comm</code> is a tibble (object of class
<code>tbl_df</code>).</p></td>
    </tr>
    <tr>
      <th>tbl_out</th>
      <td><p>Logical vector of length 1; should the output be returned as
a tibble? If <code>FALSE</code>, will return a dataframe. Defaults to <code>TRUE</code> if <code>comm</code> is
a tibble.</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>Logical vector of length 1; if <code>TRUE</code>, suppress all warnings and
messages that would be emitted by this function.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Dataframe. For each of the biodiversity metrics, the following 9 columns
will be produced:</p><ul>
<li><p><code>*_obs</code>: Observed value</p></li>
<li><p><code>*_obs_c_lower</code>: Count of times observed value was lower than random values</p></li>
<li><p><code>*_obs_c_upper</code>: Count of times observed value was higher than random values</p></li>
<li><p><code>*_obs_p_lower</code>: Percentage of times observed value was lower than random values</p></li>
<li><p><code>*_obs_p_upper</code>: Percentage of times observed value was higher than random values</p></li>
<li><p><code>*_obs_q</code>: Count of the non-NA random values used for comparison</p></li>
<li><p><code>*_obs_z</code>: Standard effect size (z-score)</p></li>
<li><p><code>*_rand_mean</code>: Mean of the random values</p></li>
<li><p><code>*_rand_sd</code>: Standard deviation of the random values</p></li>
</ul>

<p>So if you included <code>pd</code> in <code>metrics</code>, the output columns would include <code>pd_obs</code>,
<code>pd_obs_c_lower</code>, etc...</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The biodiversity metrics (<code>metrics</code>) available for analysis include:</p><ul>
<li><p><code>pd</code>: Phylogenetic diversity (Faith 1992)</p></li>
<li><p><code>rpd</code>: Relative phylogenetic diversity (Mishler et al 2014)</p></li>
<li><p><code>pe</code>: Phylogenetic endemism (Rosauer et al 2009)</p></li>
<li><p><code>rpe</code>: Relative phylogenetic endemism (Mishler et al 2014)</p></li>
</ul>

<p>(<code>pe</code> and <code>rpe</code> are needed for CANAPE with <code><a href='cpr_classify_endem.html'>cpr_classify_endem</a>()</code>)</p>
<p>The choice of a randomization algorithm (<code>null_model</code>) is not trivial, and may
strongly affect results. <code>cpr_rand_test()</code> uses null models provided by
<code>vegan</code>; for a complete list, see the help file of <code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::commsim()</a></code> or run
<code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::make.commsim()</a></code>. One frequently used null model is <code>swap</code> (Gotelli &amp;
Entsminger 2003), which randomizes the community matrix while preserving
column and row sums (marginal sums). For a review of various null models, see
Strona et al. (2018); <code>swap</code> is an "FF" model in the sense of Strona et al.
(2018).</p>
<p>Instead of using one of the predefined null models in <code><a href='https://rdrr.io/pkg/vegan/man/commsim.html'>vegan::commsim()</a></code>, it
is also possible to define a custom null model; see <strong>Examples</strong> in
<code><a href='cpr_rand_comm.html'>cpr_rand_comm</a>()</code></p>
<p>Note that the pre-defined models in <code>vegan</code> include binary models (designed
for presence-absence data) and quantitative models (designed for abundance
data). Although the binary models will accept abundance data, they treat it
as binary and always return a binary (presence-absence) matrix. The PD and PE
calculations in <code>canaper</code> are not abundance-weighted, so they return the same
result regardless of whether the input is presence-absence or abundance. In
that sense, binary null models are appropriate for <code>cpr_rand_test()</code>. The
quantitative models could also be used for abundance data, but the output
will be treated as binary anyways when calculating PD and PE. The effects of
using binary vs. quantitative null models for <code>cpr_rand_test()</code> have not been
investigated.</p>
<p>A minimum of 5 species and sites are required as input; fewer than that is
likely cause the some randomization algorithms (e.g., <code>swap</code>) to enter an
infinite loop. Besides, inferences on very small numbers of species and/or
sites is not recommended generally.</p>
<p>The following rules apply to <code>comm</code> input:</p><ul>
<li><p>If dataframe or matrix, must include row names (site names) and column names (species names).</p></li>
<li><p>If tibble, a single column (default, <code>site</code>) must be included with site names, and other columns must correspond to species names.</p></li>
<li><p>Column names cannot start with a number and must be unique.</p></li>
<li><p>Row names (site names) must be unique.</p></li>
<li><p>Values (other than site names) should only include integers &gt;= 0; non-integer input will be converted to integer.</p></li>
</ul>

<p>The results are identical regardless of whether the input for <code>comm</code> is
abundance or presence-absence data (i.e., abundance weighting is not used).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Faith DP (1992) Conservation evaluation and phylogenetic diversity.
Biological Conservation, 61:1–10. doi: <a href='https://doi.org/10.1016/0006-3207(92)91201-3'>10.1016/0006-3207(92)91201-3</a></p>
<p>Gotelli, N.J. and Entsminger, N.J. (2003). Swap algorithms in null
model analysis. Ecology 84, 532–535.</p>
<p>Mishler, B., Knerr, N., González-Orozco, C. et al.  (2014)
Phylogenetic measures of biodiversity and neo- and paleo-endemism in
Australian Acacia. Nat Commun, 5: 4473. doi: <a href='https://doi.org/10.1038/ncomms5473'>10.1038/ncomms5473</a></p>
<p>Rosauer, D., Laffan, S.W., Crisp, M.D., Donnellan, S.C. and Cook,
L.G. (2009) Phylogenetic endemism: a new approach for identifying
geographical concentrations of evolutionary history. Molecular Ecology, 18:
4061-4072. doi: <a href='https://doi.org/10.1111/j.1365-294X.2009.04311.x'>10.1111/j.1365-294X.2009.04311.x</a></p>
<p>Strona, G., Ulrich, W. and Gotelli, N.J. (2018), Bi-dimensional null
model analysis of presence-absence binary matrices. Ecology, 99: 103-115.
doi: <a href='https://doi.org/10.1002/ecy.2043'>10.1002/ecy.2043</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>12345</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>phylocom</span><span class='op'>)</span>
<span class='co'># Returns a dataframe by defualt</span>
<span class='fu'>cpr_rand_test</span><span class='op'>(</span><span class='va'>phylocom</span><span class='op'>$</span><span class='va'>comm</span>, <span class='va'>phylocom</span><span class='op'>$</span><span class='va'>phy</span>, null_model <span class='op'>=</span> <span class='st'>"curveball"</span>, metrics <span class='op'>=</span> <span class='st'>"pd"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: Dropping tips from the tree because they are not present in the community data: </span>
#&gt; <span class='warning'> sp16, sp23, sp27, sp28, sp30, sp31, sp32</span></div><div class='output co'>#&gt;            pd_obs pd_rand_mean pd_rand_sd  pd_obs_z pd_obs_c_upper
#&gt; clump1  0.3018868    0.4620755 0.03964079 -4.041006              0
#&gt; clump2a 0.3207547    0.4669811 0.03531139 -4.141056              0
#&gt; clump2b 0.3396226    0.4694340 0.03210069 -4.043880              0
#&gt; clump4  0.4150943    0.4643396 0.03401675 -1.447678              5
#&gt; even    0.5660377    0.4686792 0.03112702  3.127780            100
#&gt; random  0.5094340    0.4669811 0.03120260  1.360554             87
#&gt;         pd_obs_c_lower pd_obs_q pd_obs_p_upper pd_obs_p_lower
#&gt; clump1             100      100           0.00           1.00
#&gt; clump2a            100      100           0.00           1.00
#&gt; clump2b            100      100           0.00           1.00
#&gt; clump4              88      100           0.05           0.88
#&gt; even                 0      100           1.00           0.00
#&gt; random               3      100           0.87           0.03</div><div class='input'>
<span class='co'># Tibbles may be preferable because of the large number of columns</span>
<span class='fu'>cpr_rand_test</span><span class='op'>(</span><span class='va'>phylocom</span><span class='op'>$</span><span class='va'>comm</span>, <span class='va'>phylocom</span><span class='op'>$</span><span class='va'>phy</span>, null_model <span class='op'>=</span> <span class='st'>"curveball"</span>, tbl_out <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: Dropping tips from the tree because they are not present in the community data: </span>
#&gt; <span class='warning'> sp16, sp23, sp27, sp28, sp30, sp31, sp32</span></div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 6 × 55</span>
#&gt;   site    pd_obs pd_rand_mean pd_rand_sd pd_obs_z pd_obs_c_upper pd_obs_c_lower
#&gt;   <span style='color: #949494; font-style: italic;'>&lt;chr&gt;</span>    <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>        <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>      <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>    <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>          <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>          <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span> clump1   0.302        0.468     0.037<span style='text-decoration: underline;'>4</span>    -<span style='color: #BB0000;'>4.43</span>              0            100
#&gt; <span style='color: #BCBCBC;'>2</span> clump2a  0.321        0.467     0.034<span style='text-decoration: underline;'>4</span>    -<span style='color: #BB0000;'>4.26</span>              0            100
#&gt; <span style='color: #BCBCBC;'>3</span> clump2b  0.340        0.474     0.034<span style='text-decoration: underline;'>1</span>    -<span style='color: #BB0000;'>3.93</span>              0            100
#&gt; <span style='color: #BCBCBC;'>4</span> clump4   0.415        0.466     0.036<span style='text-decoration: underline;'>6</span>    -<span style='color: #BB0000;'>1.39</span>              5             90
#&gt; <span style='color: #BCBCBC;'>5</span> even     0.566        0.460     0.033<span style='text-decoration: underline;'>0</span>     3.21            100              0
#&gt; <span style='color: #BCBCBC;'>6</span> random   0.509        0.466     0.031<span style='text-decoration: underline;'>6</span>     1.38             84              3
#&gt; <span style='color: #949494;'># … with 48 more variables: pd_obs_q &lt;dbl&gt;, pd_obs_p_upper &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   pd_obs_p_lower &lt;dbl&gt;, pd_alt_obs &lt;dbl&gt;, pd_alt_rand_mean &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   pd_alt_rand_sd &lt;dbl&gt;, pd_alt_obs_z &lt;dbl&gt;, pd_alt_obs_c_upper &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   pd_alt_obs_c_lower &lt;dbl&gt;, pd_alt_obs_q &lt;dbl&gt;, pd_alt_obs_p_upper &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   pd_alt_obs_p_lower &lt;dbl&gt;, rpd_obs &lt;dbl&gt;, rpd_rand_mean &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   rpd_rand_sd &lt;dbl&gt;, rpd_obs_z &lt;dbl&gt;, rpd_obs_c_upper &lt;dbl&gt;,</span>
#&gt; <span style='color: #949494;'>#   rpd_obs_c_lower &lt;dbl&gt;, rpd_obs_q &lt;dbl&gt;, rpd_obs_p_upper &lt;dbl&gt;, …</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joel H. Nitta.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


